<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building and Deploying Workflows with the Operator :: SonataFlow Guides</title>
    <meta name="description" content="Build and deploy with SonataFlow Operator">
    <meta name="keywords" content="kogito, sonataflow, workflow, serverless, operator, kubernetes, minikube, openshift, containers">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">

<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="stylesheet" href="../../../../_/css/menu.css">
<link rel="stylesheet" href="../../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../../_/css/navbar.css">
<link rel="stylesheet" href="../../../../_/css/custom.css">
<link rel="stylesheet" href="../../../../_/css/home.css"><script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <div class="navbar-item">
                <a href="../../../..">
                    <img src="../../../../_/img/kogitoLogo_default_64px.png" height="50px" alt="Kogito logo"/>
                </a>
                <a class="navbar-item" href="../../../..">
                    SonataFlow Guides
                </a>
            </div>
                <div class="navbar-item search hide-for-print">
                    <div id="search-field" class="field">
                        <input id="search-input" type="text" placeholder="Search docs">
                    </div>
                </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a class="navbar-item small-item" href="https://github.com/apache"
                       target="_blank" title="Follow KIE on GitHub">
                        <div class="github-icon"></div>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="serverlessworkflow" data-version="1.41.0.Final">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Kogito Serverless Workflow Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../release_notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../getting-started/create-your-first-workflow-service-with-kn-cli-and-vscode.html">Creating and running workflow projects using KN CLI and Visual Studio Code</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../getting-started/create-your-first-workflow-service.html">Creating a Quarkus Workflow Project</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/cncf-serverless-workflow-specification-support.html">Serverless Workflow Specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/handling-events-on-workflows.html">Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/working-with-callbacks.html">Callbacks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/understanding-jq-expressions.html">jq Expressions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/understanding-workflow-error-handling.html">Error handling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/configuration-properties.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/defining-an-input-schema-for-workflows.html">Input Schema</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/custom-functions-support.html">Custom Functions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/timeouts-support.html">Timeouts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/working-with-parallelism.html">Parallelism</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-overview.html">Editor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome extension for GitHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-overview.html">Serverless Logic Web Tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-github-integration.html">Integration with GitHub</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-openshift-integration.html">Integration with OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-redhat-application-services-integration.html">Integration with Service Registries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-deploy-projects.html">Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../service-orchestration/orchestration-of-openapi-based-services.html">OpenAPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../service-orchestration/configuring-openapi-services-endpoints.html">Advanced Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../service-orchestration/working-with-openapi-callbacks.html">Callbacks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../service-orchestration/orchestration-of-grpc-services.html">gRPC</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Event Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../eventing/orchestration-of-asyncapi-based-services.html">AsyncAPI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../eventing/event-correlation-with-workflows.html">Event Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quarkus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../eventing/consume-producing-events-with-kafka.html">Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../eventing/consume-produce-events-with-knative-eventing.html">Knative Eventing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Client Authentication</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../security/authention-support-for-openapi-services.html">OpenAPI Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../security/orchestrating-third-party-services-with-oauth2.html">OpenAPI OAuth2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Executing, Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Executing and Testing Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Developer UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-monitoring-page.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-custom-dashboard-page.html">Dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../testing-and-troubleshooting/kn-plugin-workflow-overview.html">Command Line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quarkus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../testing-and-troubleshooting/mocking-http-cloudevents-with-wiremock.html">Mocking HTTP CloudEvents</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../testing-and-troubleshooting/mocking-openapi-services-with-wiremock.html">Mocking OpenAPI Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../testing-and-troubleshooting/basic-integration-tests-with-restassured.html">Testing with REST Assured</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quarkus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../persistence/persistence-with-postgresql.html">PostgreSQL Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../persistence/postgresql-flyway-migration.html">PostgreSQL Database Migration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../persistence/integration-tests-with-postgresql.html">Integration Tests with PostgreSQL</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Operator</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="install-serverless-operator.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="developing-workflows.html">Development Mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="referencing-resource-files.html">Referencing Workflow Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="configuring-workflows.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="build-and-deploy-workflows.html">Building and Deploying Workflow Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="workflow-status-conditions.html">Custom Resource Status</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="known-issues.html">Known Issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quarkus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../quarkus/build-workflow-image-with-quarkus-cli.html">Building Workflow Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../quarkus/deploying-on-minikube.html">Deploying on Minikube</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../quarkus/deploying-on-kubernetes.html">Deploying on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../quarkus/deploying-on-openshift.html">Deploying on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../quarkus/kubernetes-service-discovery.html">Service Discovery</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrations/camel-routes-integration.html">Camel Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrations/custom-functions-knative.html">Knative Serving</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrations/expose-metrics-to-prometheus.html">Exposing Prometheus Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../integrations/serverless-dashboard-with-runtime-data.html">Displaying workflow Data in Dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Job Service</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../job-services/core-concepts.html">Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../job-services/quarkus-extensions.html">Quarkus Extensions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Index</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-index/data-index-core-concepts.html">Core concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-index/data-index-service.html">Standalone service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-index/data-index-quarkus-extension.html">Quarkus Extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Use Cases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../use-cases/orchestration-based-saga-pattern.html">Saga Orchestration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../use-cases/timeout-showcase-example.html">Timeouts Showcase</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SonataFlow Guides</span>
    <span class="version">1.41</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../../latest/index.html">SonataFlow Guides</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../main/index.html">snapshot</a>
        </li>
        <li class="version">
          <a href="../../../1.45.0-SNAPSHOT/index.html">1.45-RC</a>
        </li>
        <li class="version">
          <a href="../../../1.44.0-SNAPSHOT/index.html">1.44-RC</a>
        </li>
        <li class="version is-latest">
          <a href="../../../latest/index.html">1.43</a>
        </li>
        <li class="version">
          <a href="../../../1.42.0.Final/index.html">1.42</a>
        </li>
        <li class="version is-current">
          <a href="../../index.html">1.41</a>
        </li>
        <li class="version">
          <a href="../../../1.40.0.Final/index.html">1.40</a>
        </li>
        <li class="version">
          <a href="../../../1.39.0.Final/index.html">1.39</a>
        </li>
        <li class="version">
          <a href="../../../1.38.0.Final/index.html">1.38</a>
        </li>
        <li class="version">
          <a href="../../../1.37.0.Final/index.html">1.37</a>
        </li>
        <li class="version">
          <a href="../../../1.36.1.Final/index.html">1.36</a>
        </li>
        <li class="version">
          <a href="../../../1.35.0.Final/index.html">1.35</a>
        </li>
        <li class="version">
          <a href="../../../1.34.0.Final/index.html">1.34</a>
        </li>
        <li class="version">
          <a href="../../../1.33.0.Final/index.html">1.33</a>
        </li>
        <li class="version">
          <a href="../../../1.32.0.Final/index.html">1.32</a>
        </li>
        <li class="version">
          <a href="../../../1.31.1.Final/index.html">1.31</a>
        </li>
        <li class="version">
          <a href="../../../1.30.0.Final/index.html">1.30</a>
        </li>
        <li class="version">
          <a href="../../../1.29.0.Final/index.html">1.29</a>
        </li>
        <li class="version">
          <a href="../../../1.28.0.Final/index.html">1.28</a>
        </li>
        <li class="version">
          <a href="../../../1.27.0.Final/index.html">1.27</a>
        </li>
        <li class="version">
          <a href="../../../1.26.0.Final/index.html">1.26</a>
        </li>
        <li class="version">
          <a href="../../../1.25.0.Final/index.html">1.25</a>
        </li>
        <li class="version">
          <a href="../../../1.24.1.Final/index.html">1.24</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Kogito Serverless Workflow Guides</a></li>
    <li><a href="../index.html">Cloud</a></li>
    <li>Operator</li>
    <li><a href="build-and-deploy-workflows.html">Building and Deploying Workflow Images</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.41</button>
  <div class="version-menu">
    <a class="version" href="../../../main/cloud/operator/build-and-deploy-workflows.html">snapshot</a>
    <a class="version" href="../../../1.45.0-SNAPSHOT/cloud/operator/build-and-deploy-workflows.html">1.45-RC</a>
    <a class="version" href="../../../1.44.0-SNAPSHOT/cloud/operator/build-and-deploy-workflows.html">1.44-RC</a>
    <a class="version" href="../../../latest/cloud/operator/build-and-deploy-workflows.html">1.43</a>
    <a class="version" href="../../../1.42.0.Final/cloud/operator/build-and-deploy-workflows.html">1.42</a>
    <a class="version is-current" href="build-and-deploy-workflows.html">1.41</a>
    <a class="version" href="../../../1.40.0.Final/cloud/operator/build-and-deploy-workflows.html">1.40</a>
    <a class="version" href="../../../1.39.0.Final/cloud/operator/build-and-deploy-workflows.html">1.39</a>
    <a class="version" href="../../../1.38.0.Final/cloud/operator/build-and-deploy-workflows.html">1.38</a>
    <a class="version" href="../../../1.37.0.Final/cloud/operator/build-and-deploy-workflows.html">1.37</a>
    <a class="version is-missing" href="../../../1.36.1.Final/index.html">1.36</a>
    <a class="version is-missing" href="../../../1.35.0.Final/index.html">1.35</a>
    <a class="version is-missing" href="../../../1.34.0.Final/index.html">1.34</a>
    <a class="version is-missing" href="../../../1.33.0.Final/index.html">1.33</a>
    <a class="version is-missing" href="../../../1.32.0.Final/index.html">1.32</a>
    <a class="version is-missing" href="../../../1.31.1.Final/index.html">1.31</a>
    <a class="version is-missing" href="../../../1.30.0.Final/index.html">1.30</a>
    <a class="version is-missing" href="../../../1.29.0.Final/index.html">1.29</a>
    <a class="version is-missing" href="../../../1.28.0.Final/index.html">1.28</a>
    <a class="version is-missing" href="../../../1.27.0.Final/index.html">1.27</a>
    <a class="version is-missing" href="../../../1.26.0.Final/index.html">1.26</a>
    <a class="version is-missing" href="../../../1.25.0.Final/index.html">1.25</a>
    <a class="version is-missing" href="../../../1.24.1.Final/index.html">1.24</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/apache/incubator-kie-kogito-docs/edit/1.41.x/serverlessworkflow/modules/ROOT/pages/cloud/operator/build-and-deploy-workflows.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Building and Deploying Workflows with the Operator</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how to build and deploy your workflow on a cluster using the <a href="https://github.com/kiegroup/kogito-serverless-operator/">SonataFlow Operator</a> only by having a <code>SonataFlow</code> custom resource.</p>
</div>
<div class="paragraph">
<p>Every time you need to change the workflow definition the system will (re)build a new immutable version of the workflow. If you&#8217;re still in development phase, please see the <a href="developing-workflows.html" class="xref page">Developing Workflow with the Operator</a> guide.</p>
</div>
<div class="paragraph">
<p>Follow the <a href="#building-kubernetes">Kubernetes</a> or <a href="#building-openshift">OpenShift</a> sections of this document based on the cluster you wish to build your workflows on.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SonataFlow Operator is under active development with features yet to be implemented. Please see <a href="known-issues.html" class="xref page">SonataFlow Operator Known Issues, Limitations and Roadmap</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Workflow definition.</p>
</li>
<li>
<p>The SonataFlow Operator installed. See <a href="install-serverless-operator.html" class="xref page">Install the SonataFlow Operator</a> guide</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-build-system"><a class="anchor" href="#configure-build-system"></a>Configuring the build system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The operator can build workflows on Kubernetes or OpenShift. On Kubernetes, it uses <a href="https://github.com/GoogleContainerTools/kaniko">Kaniko</a> and on OpenShift a <a href="https://docs.openshift.com/container-platform/4.13/cicd/builds/understanding-image-builds.html">standard BuildConfig</a>. The operator build system is not tailored for advanced use cases and you can do only a few customizations.</p>
</div>
<div class="sect2">
<h3 id="_using_another_workflow_base_builder_image"><a class="anchor" href="#_using_another_workflow_base_builder_image"></a>Using another Workflow base builder image</h3>
<div class="paragraph">
<p>If your scenario has strict policies for image usage, such as security or hardening constraints, you can replace the default image used by the operator to build the final workflow container image. Alternatively, you might want to test a nightly build with a bug fix or a custom image containing your customizations.</p>
</div>
<div class="paragraph">
<p>By default, the operator will use the image distributed upstream to run the workflows in the development profile. You can change this image by editing the <code>SonataFlowPlatform</code> custom resource in the namespace where you deployed your workflows:</p>
</div>
<div class="listingblock">
<div class="title">Patching the current SonataFlowPlatform with the new builder image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># use `kubectl get sonataflowplatform` to get the SonataFlowPlatform name
kubectl patch sonataflowplatform &lt;name&gt; --patch  'spec:\n plaform:\n baseImage: &lt;your new image full name with tag&gt;' -n &lt;your_namespace&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customize_the_base_build_dockerfile"><a class="anchor" href="#_customize_the_base_build_dockerfile"></a>Customize the base build Dockerfile</h3>
<div class="paragraph">
<p>The operator uses the sonataflow-operator-builder-config <code>ConfigMap</code> in the operator&#8217;s installation namespace (sonataflow-operator-system) to configure and run the workflow build process.
You can change the <code>Dockerfile</code> entry in this <code>ConfigMap</code> to tailor the Dockerfile to your needs. Just be aware that this can break the build process.</p>
</div>
<div class="listingblock">
<div class="title">Example of the sonataflow-operator-builder-config <code>ConfigMap</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
data:
  DEFAULT_BUILDER_RESOURCE_NAME: Dockerfile
  DEFAULT_WORKFLOW_EXTENSION: .sw.json
  Dockerfile: "FROM quay.io/kiegroup/kogito-swf-builder-nightly:latest AS builder\n
    \ \n  # Copy from build context to skeleton resources project\nCOPY * ./resources/\n\nRUN
    /home/kogito/launch/build-app.sh ./resources\n  \n  #=============================\n
    \ # Runtime Run\n  #=============================\nFROM registry.access.redhat.com/ubi8/openjdk-11:latest\n\nENV
    LANG='en_US.UTF-8' LANGUAGE='en_US:en'\n  \n  # We make four distinct layers so
    if there are application changes the library layers can be re-used\nCOPY --from=builder
    --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/lib/ /deployments/lib/\nCOPY
    --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/*.jar
    /deployments/\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/app/
    /deployments/app/\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/quarkus/
    /deployments/quarkus/\n\nEXPOSE 8080\nUSER 185\nENV AB_JOLOKIA_OFF=\"\"\nENV JAVA_OPTS=\"-Dquarkus.http.host=0.0.0.0
    -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\nENV JAVA_APP_JAR=\"/deployments/quarkus-run.jar\"\n"
kind: ConfigMap
metadata:
  name: sonataflow-operator-builder-config</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The excerpt above is just an example. The current version might have a slightly different version. Don&#8217;t use this example in your installation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_changing_resources_requirements"><a class="anchor" href="#_changing_resources_requirements"></a>Changing resources requirements</h3>
<div class="paragraph">
<p>You can create or edit a <code>SonataFlowPlatform</code> in the workflow namespace specifying the <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resources requirements</a> for the internal builder pods:</p>
</div>
<div class="listingblock">
<div class="title">Example of SonataFlowPlatform</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  build:
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every build process will reuse this configuration and start new instances based on it from now on.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only one <code>SonataFlowPlatform</code> is allowed per namespace. Try fetching the one the operator created for you and edit it instead of trying to create another one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can fine tune the resources requirements for a particular workflow. Every workflow instance will have a <code>SonataFlowBuild</code> instance created with the same name as the workflow. You can edit the <code>SonataFlowBuild</code> custom resource and specify the same parameters. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of SonataFlowBuild</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: my-workflow
spec:
    resources:
        requests:
        memory: "64Mi"
        cpu: "250m"
        limits:
        memory: "128Mi"
        cpu: "500m"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This parameters will only apply to new build instances.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-kubernetes"><a class="anchor" href="#building-kubernetes"></a>Building on Kubernetes</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can skip this section if you&#8217;re running <a href="#building-openshift">on OpenShift</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow these steps to configure your Kubernetes namespace to build workflow images with the operator.</p>
</div>
<div class="sect2">
<h3 id="_create_a_namespace_for_the_building_phase"><a class="anchor" href="#_create_a_namespace_for_the_building_phase"></a>Create a Namespace for the building phase</h3>
<div class="paragraph">
<p>Create a new namespace that will hold all the resources that the operator will create (Pods, Deployments, Services, Secrets, ConfigMap, and Custom Resources) in this guide.</p>
</div>
<div class="listingblock">
<div class="title">Create a Namespace for the workflow to build and run in</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create namespace workflows
# set the workflows namespace to your context
kubectl config set-context --current --namespace=workflows</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_secret_for_the_container_registry_authentication"><a class="anchor" href="#_create_a_secret_for_the_container_registry_authentication"></a>Create a Secret for the container registry authentication</h3>
<div class="paragraph">
<p>You can follow these steps to publish on external registry that requires authentication. If you&#8217;re running on Minikube, just <a href="https://minikube.sigs.k8s.io/docs/handbook/registry/#enabling-insecure-registries">enable the internal registry</a>. You can skip this whole section since the internal Minikube registry doesn&#8217;t require authentication.</p>
</div>
<div class="listingblock">
<div class="title">Create a secret for the container registry authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create secret docker-registry regcred --docker-server=&lt;registry_url&gt; --docker-username=&lt;registry_username&gt; --docker-password=&lt;registry_password&gt; --docker-email=&lt;registry_email&gt; -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>or you can directly import your local Docker config into your Kubernetes cluster:</p>
</div>
<div class="listingblock">
<div class="title">Create a Secret for the container registry authentication based on local Docker config</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create secret generic regcred --from-file=.dockerconfigjson=${HOME}/.docker/config.json --type=kubernetes.io/dockerconfigjson -n workflows</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Double-check your <code>${HOME}/.docker/config.json</code>. If you&#8217;re using local desktop authentication, this configuration <strong>won&#8217;t work</strong> in the cluster. You can initialize this by logging in to the target registry, e.g. <code>docker login</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_the_sonataflow_operator_i_e_registry_address_secret_for_building_your_workflows"><a class="anchor" href="#_configure_the_sonataflow_operator_i_e_registry_address_secret_for_building_your_workflows"></a>Configure the SonataFlow Operator (i.e. registry address, secret) for building your Workflows</h3>
<div class="paragraph">
<p>The <code>SonataFlowPlatform</code> is the Custom Resource used to control the behavior of the SonataFlow Operator.
It defines the behavior of the operator when handling all Kogito Serverless Workflow Custom Resources (Workflow and Build) in the given namespace.</p>
</div>
<div class="paragraph">
<p>Since the operator is installed in global mode, you will need to specify a <code>SonataFlowPlatform</code> in each Namespace where you want to deploy Workflows.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have deployed a workflow for <a href="developing-workflows.html" class="xref page">development</a> you already have a <code>SonataFlowPlatform</code> custom resource since the operator created one for you. Just edit the one you have.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following is a very basic <code>SonataFlowPlatform</code> Custom Resource example to work on Kubernetes:</p>
</div>
<div class="listingblock">
<div class="title">Example of a basic SonataFlowPlatform on Kubernetes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  platform:
    buildStrategyOptions:
      KanikoBuildCacheEnabled: "true"
    registry:
      address: quay.io/kiegroup <i class="conum" data-value="1"></i><b>(1)</b>
      secret: regcred <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Your registry address</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The secret name created in the steps above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On Minikube, you can remove the <code>registry</code> information entirely since you don&#8217;t need credentials for pushing to the internal registry:</p>
</div>
<div class="listingblock">
<div class="title">Example of a basic SonataFlowPlatform on Minikube</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  platform:
    buildStrategyOptions:
      KanikoBuildCacheEnabled: "true"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>spec.platform.buildStrategyOptions.KanikoBuildCacheEnabled</code> enables the internal Kaniko process to cache builder images to try to speed up the bulding execution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can save this file locally and run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Create a <code>SonataFlowPlatform</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f my-sonataflowplatform.yaml -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also update "on-the-fly" the <code>SonataFlowPlatform</code> registry field with this command (change &lt;YOUR_REGISTRY&gt;)</p>
</div>
<div class="listingblock">
<div class="title">Create a <code>SonataFlowPlatform</code> with a specific registry</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat my-sonataflowplatform.yaml | sed "s|address: .*|address: &lt;YOUR_REGISTRY&gt;" | kubectl apply -f -</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-openshift"><a class="anchor" href="#building-openshift"></a>Building on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You don&#8217;t need to do anything to build on OpenShift since the operator will configure everything for you. There are a few customizations you can do described in the <a href="#configure-build-system">Configuring the build system</a> section.</p>
</div>
<div class="paragraph">
<p>In general, the operator will create a <a href="https://docs.openshift.com/container-platform/4.13/cicd/builds/understanding-image-builds.html"><code>BuildConfig</code> to build</a> the workflow using the mapped <a href="referencing-resource-files.html" class="xref page">resource files</a> and your workflow definition. After the build is finished, the image will be pushed to the internal OpenShift registry backed by an <code>ImageStream</code> object.</p>
</div>
<div class="sect2">
<h3 id="_changing_the_base_builder_image"><a class="anchor" href="#_changing_the_base_builder_image"></a>Changing the base builder image</h3>
<div class="paragraph">
<p>If you are running on OpenShift, you have access to the Red Hat&#8217;s supported registry. You can change the default builder image by editing the sonataflow-operator-builder-config <code>ConfigMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc edit cm/sonataflow-operator-builder-config -n sonataflow-operator-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your editor, change the first line in the <code>Dockerfile</code> entry where it reads <code>FROM quay.io/kiegroup/kogito-swf-builder-nightly:latest</code> to the desired image.</p>
</div>
<div class="paragraph">
<p>This image must be compatible with your operator&#8217;s installation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-deploy-workflow"><a class="anchor" href="#build-deploy-workflow"></a>Build and deploy your workflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can now send your workflow definition (<code>SonataFlow</code>) to the operator.</p>
</div>
<div class="paragraph">
<p>You can find a basic <code>SonataFlow</code> bellow:</p>
</div>
<div class="listingblock">
<div class="title">Example of the greetings workflow example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: greeting
  annotations:
    sonataflow.org/description: Greeting example on k8s!
    sonataflow.org/version: 0.0.1
spec:
  flow:
    start: ChooseOnLanguage
    functions:
      - name: greetFunction
        type: custom
        operation: sysout
    states:
      - name: ChooseOnLanguage
        type: switch
        dataConditions:
          - condition: "${ .language == \"English\" }"
            transition: GreetInEnglish
          - condition: "${ .language == \"Spanish\" }"
            transition: GreetInSpanish
        defaultCondition: GreetInEnglish
      - name: GreetInEnglish
        type: inject
        data:
          greeting: "Hello from JSON Workflow, "
        transition: GreetPerson
      - name: GreetInSpanish
        type: inject
        data:
          greeting: "Saludos desde JSON Workflow, "
        transition: GreetPerson
      - name: GreetPerson
        type: operation
        actions:
          - name: greetAction
            functionRef:
              refName: greetFunction
              arguments:
                message:  ".greeting+.name"
        end: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save a file in your local file system with this contents named <code>greetings-workflow.yaml</code> then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f greetings-workflow.yaml -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check the logs of the build of your Workflow via:</p>
</div>
<div class="listingblock">
<div class="title">Get the Workflow pod logs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># on Kubernetes
kubectl logs kogito-greeting-builder -n workflows

# on OpenShift
oc logs buildconfig/greeting -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final pushed image must be printed into the logs at the end of the build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_check_if_the_workflow_is_running"><a class="anchor" href="#_check_if_the_workflow_is_running"></a>Check if the Workflow is running</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to check that the Kogito Serverless Workflow Greeting is up and running, you can try to perform a test HTTP call, from the greeting Pod.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Expose the workflow so you can access it:</p>
<div class="listingblock">
<div class="title">Exposing the greeting workflow on Minikube</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># On Minikube you can use Nodeport
kubectl patch svc greeting -n workflows -p '{"spec": {"type": "NodePort"}}'
GREETING_SVC=$(minikube service greeting -n workflows --url)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exposing the greeting workflow on OpenShift</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># On OpenShift you can expose a route: https://docs.openshift.com/container-platform/4.13/networking/routes/route-configuration.html#nw-creating-a-route_route-configuration
oc expose svc greeting -n workflows
# get the public URL
GREETING_SVC=$(oc get route/greeting --template='{{.spec.host}}')</code></pre>
</div>
</div>
</li>
<li>
<p>Make the HTTP call using <code>curl</code>:</p>
<div class="listingblock">
<div class="title">Check if the greeting workflow is running</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST -H 'Content-Type:application/json' -H 'Accept:application/json' -d '{"name": "John", "language": "English"}' $GREETING_SVC/greeting</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything is working, you should receive a response like this:</p>
</div>
<div class="listingblock">
<div class="title">Response from the greeting workflow</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"id":"b5fbfaa3-b125-4e6c-9311-fe5a3577efdd","workflowdata":{"name":"John","language":"English","greeting":"Hello from JSON Workflow, "}}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="known-issues.html" class="xref page">SonataFlow Operator Known Issues, Limitations and Roadmap</a></p>
</li>
<li>
<p><a href="developing-workflows.html" class="xref page">Developing Workflow with the Operator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/kiegroup/kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/tabsBehavior.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
