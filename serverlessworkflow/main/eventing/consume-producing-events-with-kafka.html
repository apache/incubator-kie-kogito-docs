<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Consuming and producing events with Kafka :: Kogito Serverless Workflow Guides</title>
    <meta name="description" content="Consuming and producing events with Kafka">
    <meta name="keywords" content="kogito, workflow, serverless, events, kafka">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="stylesheet" href="../../../_/css/menu.css">
<link rel="stylesheet" href="../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../_/css/navbar.css">
<link rel="stylesheet" href="../../../_/css/custom.css">
<link rel="stylesheet" href="../../../_/css/home.css"><script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <div class="navbar-item">
                <a href="../../..">
                    <img src="../../../_/img/kogitoLogo_default_64px.png" height="50px" alt="Kogito logo"/>
                </a>
                <a class="navbar-item" href="../../..">
                    Kogito Serverless Workflow Guides
                </a>
            </div>
                <div class="navbar-item search hide-for-print">
                    <div id="search-field" class="field">
                        <input id="search-input" type="text" placeholder="Search docs">
                    </div>
                </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <a class="navbar-item small-item" href="https://github.com/kiegroup"
                       target="_blank" title="Follow KIE on GitHub">
                        <div class="github-icon"></div>
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="serverlessworkflow" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Kogito Serverless Workflow Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/create-your-first-workflow-service.html">Creating your first Serverless Workflow service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/cncf-serverless-workflow-specification-support.html">CNCF Serverless Workflow specification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/understanding-jq-expressions.html">jq expressions in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/understanding-workflow-error-handling.html">Error handling in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/working-with-parallelism.html">Parallelism in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/custom-functions-support.html">Custom functions for your Serverless Workflow service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-overview.html">Serverless Workflow editor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome GitHub extension for Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension for Serverless Workflow editor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Kogito Serverless Workflow Tools extension in Quarkus Dev UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances in Kogito Serverless Workflow Tools extension</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions in Kogito Serverless Workflow Tools extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tooling/kn-plugin-workflow-overview.html">Serverless Workflow plug-in for Knative CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../service-orchestration/orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../service-orchestration/orchestration-of-grpc-services.html">Orchestration of gRPC based services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Eventing</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="consume-producing-events-with-kafka.html">Consuming and producing events with Kafka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="working-with-callbacks.html">Callbacks in Serverless Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/authention-support-for-openapi-services.html">Authentication for OpenAPI services in Serverless Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/orchestrating-third-party-services-with-oauth2.html">Orchestration of third-party services using OAuth 2.0 authentication in Serverless Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-http-cloudevents-with-wiremock.html">Mocking HTTP CloudEvents sink using WireMock</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#testing-and-troubleshooting/mocking-opnapi-services-with-wiremock.adoc">Mocking OpenAPI services using WireMock</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testing-and-troubleshooting/basic-integration-tests-with-restassured.html">Testing your Serverless Workflow application using REST Assured</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/build-workflow-image-with-quarkus-cli.html">Building Serverless Workflow Images using Quarkus CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/deploying-on-minikube.html">Deploying your Serverless Workflow application on Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/serverless-dashboard-with-runtime-data.html">Displaying Serverless Workflow data in dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Use Cases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/orchestration-based-saga-pattern.html">Saga orchestration example in Serverless Workflow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kogito Serverless Workflow Guides</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Kogito Serverless Workflow Guides</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Kogito Serverless Workflow Guides</a></li>
    <li>Eventing</li>
    <li><a href="consume-producing-events-with-kafka.html">Consuming and producing events with Kafka</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/kiegroup/kogito-docs/edit/main/serverlessworkflow/modules/ROOT/pages/eventing/consume-producing-events-with-kafka.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Consuming and producing events with Kafka</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide focuses on how to configure Kogito Serverless Workflow to interact with link: <a href="https://kafka.apache.org/documentation/">Kafka</a>. Kafka uses an abstraction called topic to classify events. Events are published to a topic and events are consumed from a topic.</p>
</div>
<div class="paragraph">
<p>Kogito uses <a href="https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/3.3//connectors/connectors.html">Smallrye connectors</a> to encapsulate access to several brokers. This allows Kogito to support different brokers just by changing configuration and classpath dependencies. However, it also introduces an extra layer of indirection: an entity called channel. Channels are unidirectional, they have to be declared as input (<code>incoming</code>) or output (<code>outgoing</code>), and this definition is immutable. When using Kafka, Smallrye channels must be mapped to Kafka topics through configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_kafka_dependency"><a class="anchor" href="#_adding_kafka_dependency"></a>Adding Kafka dependency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to instruct Kogito Serverless Workflow to use the Kafka Smallrye connector. This info is extracted from <a href="https://docs.jboss.org/kogito/release/latest/html_single/#proc-messaging-enabling_kogito-configuring">Kogito documentation</a></p>
</div>
<div class="paragraph">
<p>Although Kogito Messaging capabilities are optional, they are already included in the Quarkus Serverless Workflow Extension. Thats why you do not need to explicitly include the messaging add-on dependency when using Serverless Workflow. However, you need to indicate that you are going to use Kafka by adding the Kafka Quarkus Smallrye connector dependency.</p>
</div>
<div class="paragraph">
<p>If using Maven, this means including following snippet in pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-reactive-messaging-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_smallrye_channels"><a class="anchor" href="#_configuring_smallrye_channels"></a>Configuring Smallrye channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to configure Smallrye channels for a Kogito Serverless Workflow using event definitions. This info is extracted from <a href="https://docs.jboss.org/kogito/release/latest/html_single/#_kogito_messaging_add_on">Kogito documentation</a></p>
</div>
<div class="paragraph">
<p>Channels are defined by using <a href="https://quarkus.io/guides/config">Quarkus configuration</a>. The pattern for channel properties is <code>mp.messaging.[incoming|outgoing].&lt;channel name&gt;.&lt;property_name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Kogito serverless workflow allows different channel mapping strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define one default incoming channel to receive all the incoming messages and one default outgoing channel to store all the published messages.</p>
</li>
<li>
<p>Define a channel for each <a href="https://cloudevents.io/">Cloud Event</a> Type so that every message type has a dedicated channel.</p>
</li>
<li>
<p>Define a channel for certain Cloud Event Types and let the not mapped Cloud Event types to use the default incoming or outgoing channel.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kogito first searches for channel name equals to Cloud Event type in the properties. If found, it uses that channel for that Cloud Event type. If not, it searches for default channel definition. If also not existing, then an error will be reported.</p>
</div>
<div class="paragraph">
<p>The name for the default incoming channel is <code>kogito_incoming_stream</code> and for the default outgoing channel is <code>kogito_outgoing_stream</code>.</p>
</div>
<div class="paragraph">
<p>You can change the default incoming and outgoing topic name as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">kogito.addon.messaging.incoming.defaultName=&lt;default channel name&gt;
kogito.addon.messaging.outgoing.defaultName=&lt;default channel name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the full list of <a href="https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/3.3//kafka/kafka.html#_configuration_reference">properties</a> you can use for a channel when using Kafka connector.</p>
</div>
<div class="paragraph">
<p>There are two mandatory properties that you need to setup for every channel defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connector</code>, which has to be set to <code>smallrye-kafka</code></p>
</li>
<li>
<p>Depending on the channel being input or output:</p>
<div class="ulist">
<ul>
<li>
<p>if incoming, <code>value.deserializer</code>. Unless you have specific marshaling needs, you should set it to <code>org.apache.kafka.common.serialization.ByteArrayDeserializer</code> or <code>org.apache.kafka.common.serialization.StringDeserializer</code></p>
</li>
<li>
<p>if outgoing, <code>value.serializer</code>. Unless you have specific marshaling needs, you should set it to <code>org.apache.kafka.common.serialization.ByteArraySerializer</code> or <code>org.apache.kafka.common.serialization.StringSerializer</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another relevant, although optional, property is the <code>topic</code>. If present, it should contain the Kafka topic name to be used for that channel. If missing, the channel name will be used as topic name.</p>
</div>
<div class="sect2">
<h3 id="_channel_mapping_examples"><a class="anchor" href="#_channel_mapping_examples"></a>Channel Mapping Examples</h3>
<div class="paragraph">
<p>Let&#8217;s illustrate previous explanation by reviewing the properties configured in several examples.</p>
</div>
<div class="sect3">
<h4 id="_channel_per_event_type"><a class="anchor" href="#_channel_per_event_type"></a>Channel per event type</h4>
<div class="paragraph">
<p><a href="https://github.com/kiegroup/kogito-examples/tree/main/serverless-workflow-examples/serverless-workflow-callback-quarkus/src/main/resources/application.properties}">Callback example</a> uses two Cloud Event types: <code>wait</code>, which is incoming, and <code>resume</code>, which is outgoing.</p>
</div>
<div class="paragraph">
<p>Kafka topic names matches the cloud event types, therefore it makes sense to chose one channel per Cloud Event type mapping strategy. This implies two channels must be configured. Since the channel name matches the cloud event type, we do not need to indicate the optional <code>topic</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.wait.connector=smallrye-kafka
mp.messaging.incoming.wait.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

mp.messaging.outgoing.resume.connector=smallrye-kafka
mp.messaging.outgoing.resume.value.serializer=org.apache.kafka.common.serialization.StringSerializer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_default_channel"><a class="anchor" href="#_using_default_channel"></a>Using default channel</h4>
<div class="paragraph">
<p><a href="https://github.com/kiegroup/kogito-examples/tree/main/serverless-workflow-examples/serverless-workflow-events-quarkus/src/main/resources/application.properties}">Events example</a> uses two Cloud Event types: <code>applicants</code>, which are incoming, and <code>decisions</code>, which is outgoing. The topic names matches the Cloud Event Types. Nevertheless, to illustrate the default channel functionality, <code>kogito_incoming_stream</code> and <code>kogito_outgoing_stream</code> are used as channel names. Since there is not an specific channel name for the Cloud event type, the default channels are used. They need to be mapped to the desired topic name by using the <code>topic</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.kogito_incoming_stream.connector=smallrye-kafka
mp.messaging.incoming.kogito_incoming_stream.topic=applicants
mp.messaging.incoming.kogito_incoming_stream.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

mp.messaging.outgoing.kogito_outgoing_stream.connector=smallrye-kafka
mp.messaging.outgoing.kogito_outgoing_stream.topic=decisions
mp.messaging.outgoing.kogito_outgoing_stream.value.serializer=org.apache.kafka.common.serialization.StringSerializer</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/kiegroup/kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/tabsBehavior.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
