[#job-service-quarkus-extensions]
= Job Service Quarkus Extensions
:compat-mode!:
// Metadata:
:description: Job Service Quarkus extensions in {product_name}
:keywords: sonataflow, workflow, serverless, job service, quarkus extensions

The interaction xref:job-services/core-concepts.adoc#integration-with-the-workflows[between the workflows and the Job Service] is handled by the different Job Service Quarkus Extensions. Each extension is designed to work with a different communication alternative.

For example, you can select if your workflows must interact with the Job Service by sending cloud events over the <<kogito-addons-quarkus-jobs-knative-eventing, knative eventing>> system or the <<kogito-addons-quarkus-jobs-messaging, kafka messaging>> system, or simply by executing direct <<kogito-addons-quarkus-jobs-management, REST>> calls.

Finally, for the interaction work, you must configure your Quarkus Workflow Project with the extension of your choice.

image::job-services/Quarkus-Workflow-Project-And-Extension.png[]

We recommend that you follow this procedure:

1. Identify the communication alternative that best fits your scenario.
2. Be sure that the Job Service is properly configured to support that alternative. This is very important if you want to use xref:job-services/core-concepts.adoc#knative-eventing[knative events] or xref:job-services/core-concepts.adoc#kafka-messaging[kafka messages] to communicate with it.
3. Configure your Quarkus Workflow Project with the corresponding extension.

[NOTE]
====
If your workflows are not using timer-based actions, like timeouts, there is no need to add such an extension.
====

[#kogito-addons-quarkus-jobs-knative-eventing]
== Knative eventing interaction

To interact with the Job Service by sending cloud events over the knative eventing system you must follow these steps:

. Be sure that you have read the xref:eventing/consume-produce-events-with-knative-eventing.adoc[Consuming and producing events on Knative Eventing] guide, and that you have configured the project accordingly.

. Add the `kogito-addons-quarkus-jobs-knative-eventing` extension to your Quarkus Workflow Project using any of the following alternatives:

[tabs]
====
Manually::
+
[source,xml]
----
<dependency>
    <groupId>org.kie.kogito</groupId>
    <artifactId>kogito-addons-quarkus-jobs-knative-eventing</artifactId>
</dependency>
----
Apache Maven::
+
[source,shell]
----
mvn quarkus:add-extension -Dextensions="kogito-addons-quarkus-jobs-knative-eventing"
----
Quarkus CLI::
+
[source,shell]
----
quarkus extension add kogito-addons-quarkus-jobs-knative-eventing
----
====

[start=3]
. Add the following configurations to the `application.properties` file of your project.

[source,properties]
----
mp.messaging.outgoing.kogito-job-service-job-request-events.connector=quarkus-http
mp.messaging.outgoing.kogito-job-service-job-request-events.url=${K_SINK:http://localhost:8280/v2/jobs/events}
mp.messaging.outgoing.kogito-job-service-job-request-events.method=POST
----

[NOTE]
====
The `K_SINK` environment variable is automatically generated by the combination of the knative ecosystem and the SinkBinding definition that will be automatically generated in the `kogito.yml` file.

If this variable is not present, the default value `http://localhost:8280/v2/jobs/events` is used instead, this can be useful in development environments if you are executing the Job Service as a standalone service.
====

[start=2]
. Build your project and locate the automatically generated `kogito.yml` and `knative.yml` files in the `/target/kubernetes` directory of your project, xref:eventing/consume-produce-events-with-knative-eventing.adoc#proc-generating-kn-objects-build-time[see].

[source,shell]
----
mvn clean install
----

[start=3]
. Use the generated files to deploy your workflow application in the Kubernetes cluster using the following commands:

[source, bash]
----
kubectl apply -f target/kogito.yml

kubectl apply -f target/knative.yml
----

You can see a full example of this interaction mode configuration in the xref:use-cases/timeout-showcase-example.adoc#execute-quarkus-project-standalone-services[Quarkus Workflow Project with standalone services] example project.

[#kogito-addons-quarkus-jobs-messaging]
== Kafka messaging interaction

To interact with the Job Service by sending cloud events over the kafka messaging system you must follow these steps:

. Be sure that you have read the xref:eventing/consume-producing-events-with-kafka.adoc[Consuming and producing events with Kafka] guide, and you have configured the project accordingly.

. Add the `quarkus-smallrye-reactive-messaging-kafka` and `kogito-addons-quarkus-jobs-messaging` extensions to your Quarkus Workflow Project using any of the following alternatives.

[tabs]
====
Manually::
+
[source,xml]
----
<dependency>
    <groupId>io.quarkus</groupId>
    <artifactId>quarkus-smallrye-reactive-messaging-kafka</artifactId>
</dependency>
<dependency>
    <groupId>org.kie.kogito</groupId>
    <artifactId>kogito-addons-quarkus-jobs-messaging</artifactId>
</dependency>
----

Apache Maven::
+
[source,shell]
----
mvn quarkus:add-extension -Dextensions="quarkus-smallrye-reactive-messaging-kafka,kogito-addons-quarkus-jobs-messaging"
----

Quarkus CLI::
+
[source,shell]
----
quarkus extension add quarkus-smallrye-reactive-messaging-kafka kogito-addons-quarkus-jobs-messaging
----
====

[start=3]
. Add the following configurations to the `application.properties` file of your project.

[source,properties]
----
mp.messaging.outgoing.kogito-job-service-job-request-events.connector=smallrye-kafka
mp.messaging.outgoing.kogito-job-service-job-request-events.topic=kogito-job-service-job-request-events-v2
mp.messaging.outgoing.kogito-job-service-job-request-events.value.serializer=org.apache.kafka.common.serialization.StringSerializer
----

[start=4]
. Build and deploy your workflow application using any of the available procedures.

[#kogito-addons-quarkus-jobs-management]
== REST call interaction

To interact with the Job Service by executing direct REST calls you must follow these steps:

. Add the `kogito-addons-quarkus-jobs-management` extension to your Quarkus Workflow Project using any of the following alternatives.

[tabs]
====
Manually::
+
[source,xml]
----
<dependency>
    <groupId>org.kie.kogito</groupId>
    <artifactId>kogito-addons-quarkus-jobs-management</artifactId>
</dependency>
----
Apache Maven::
+
[source,shell]
----
mvn quarkus:add-extension -Dextensions="kogito-addons-quarkus-jobs-management"
----
Quarkus CLI::
+
[source,shell]
----
quarkus extension add kogito-addons-quarkus-jobs-management
----
====

[start=3]
. Add the following configuration to the `application.properties` file of your project.

[source,properties]
----
kogito.jobs-service.url=http://localhost:8280
----

[NOTE]
====
When you deploy your project in a Kubernetes cluster, you must configure the `kogito.jobs-service-url` with the cloud URL of the Job Service.
In this case, you can also use an environment variable with the name `KOGITO_JOBS_SERVICE_URL` and pass it to the corresponding container, etc.
====

[start=4]
. Build and deploy your workflow application using any of the available procedures.

== Job Service Embedded

To facilitate the development and testing stage of your workflows, this extension provides an embedded Job Service instance that executes in the same runtime as your workflows, and thus, requires no additional configurations. The only consideration is that it must not be used for production installations.

To use this extension you must:

. Add the `kogito-addons-quarkus-jobs-service-embedded` extension to your Quarkus Workflow Project using any of the following alternatives.

[tabs]
====
Manually::
+
[source,xml]
----
<dependency>
    <groupId>org.kie.kogito</groupId>
    <artifactId>kogito-addons-quarkus-jobs-service-embedded</artifactId>
</dependency>
----
Apache Maven::
+
[source,shell]
----
mvn quarkus:add-extension -Dextensions="kogito-addons-quarkus-jobs-management"
----
Quarkus CLI::
+
[source,shell]
----
quarkus extension add kogito-addons-quarkus-jobs-management
----
====

[start=3]
. Build and deploy your workflow application using any of the available procedures.

You can see a full example of Job Service embedded usage in the xref:use-cases/timeout-showcase-example.adoc#execute-quarkus-project-embedded-services[Quarkus Workflow Project with embedded services] example project.

include::../_common-content/report-issue.adoc[]